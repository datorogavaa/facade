<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Notification Preferences</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}" />
</head>
<body class="dashboard-body">
<div class="dashboard-container">
  <aside class="sidebar">
    <div class="sidebar-title">Customer Notification<br>Business Facade System</div>
    <nav>
      <a th:href="@{/admin/dashboard}" class="sidebar-link">Dashboard</a>
      <a th:href="@{/users}" class="sidebar-link">Customers</a>
      <a th:href="@{/addresses}" class="sidebar-link">Addresses</a>
      <a th:href="@{/notification-preferences}" class="sidebar-link active">Preferences</a>
      <a th:href="@{/notification-statuses}" class="sidebar-link">Statuses</a>
      <a th:href="@{/reports/notification-status}" class="sidebar-link">Reports</a>
      <a th:href="@{/logout}" class="sidebar-link logout-link">Logout</a>
    </nav>
  </aside>

  <main class="dashboard-main">
    <section class="dashboard-section">
      <div class="section-header">
        <h2>Notification Preferences</h2>
        <button class="btn-primary" th:onclick="'location.href=\'/notification-preferences/create\''">Add New</button>
      </div>

      <!-- Search and Filter Form -->
      <form th:action="@{/notification-preferences}" method="get" class="search-form" style="margin-bottom: 1em;">
        <input type="text" name="username" placeholder="Search by user" th:value="${param.username}" />

        <select name="preferenceType">
          <option value="">All Preferences</option>
          <option value="email" th:selected="${param.preferenceType == 'email'}">Email Enabled</option>
          <option value="sms" th:selected="${param.preferenceType == 'sms'}">SMS Enabled</option>
          <option value="postal" th:selected="${param.preferenceType == 'postal'}">Postal Enabled</option>
        </select>

        <input type="hidden" name="sortField" th:value="${sortField}" />
        <input type="hidden" name="sortDir" th:value="${sortDir}" />

        <button type="submit" class="btn-primary">Search</button>
      </form>

      <!-- Table -->
      <div class="card">
        <table>
          <thead>
          <tr>
            <th>
              <a th:href="@{/notification-preferences(
                  username=${param.username},
                  preferenceType=${param.preferenceType},
                  sortField='customUser.name',
                  sortDir=${sortField == 'customUser.name' and sortDir == 'asc' ? 'desc' : 'asc'})}">
                User <span th:text="${sortField == 'customUser.name' ? (sortDir == 'asc' ? '↑' : '↓') : ''}"></span>
              </a>
            </th>
            <th>
              <a th:href="@{/notification-preferences(
                  username=${param.username},
                  preferenceType=${param.preferenceType},
                  sortField='emailEnabled',
                  sortDir=${sortField == 'emailEnabled' and sortDir == 'asc' ? 'desc' : 'asc'})}">
                Email Enabled <span th:text="${sortField == 'emailEnabled' ? (sortDir == 'asc' ? '↑' : '↓') : ''}"></span>
              </a>
            </th>
            <th>
              <a th:href="@{/notification-preferences(
                  username=${param.username},
                  preferenceType=${param.preferenceType},
                  sortField='smsEnabled',
                  sortDir=${sortField == 'smsEnabled' and sortDir == 'asc' ? 'desc' : 'asc'})}">
                SMS Enabled <span th:text="${sortField == 'smsEnabled' ? (sortDir == 'asc' ? '↑' : '↓') : ''}"></span>
              </a>
            </th>
            <th>
              <a th:href="@{/notification-preferences(
                  username=${param.username},
                  preferenceType=${param.preferenceType},
                  sortField='postalEnabled',
                  sortDir=${sortField == 'postalEnabled' and sortDir == 'asc' ? 'desc' : 'asc'})}">
                Postal Enabled <span th:text="${sortField == 'postalEnabled' ? (sortDir == 'asc' ? '↑' : '↓') : ''}"></span>
              </a>
            </th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="preference : ${preferences}">
            <td th:text="${preference.customUser.name}">John Doe</td>
            <td th:text="${preference.emailEnabled ? 'Yes' : 'No'}">Yes</td>
            <td th:text="${preference.smsEnabled ? 'Yes' : 'No'}">Yes</td>
            <td th:text="${preference.postalEnabled ? 'Yes' : 'No'}">Yes</td>
            <td>
              <a th:href="@{'/notification-preferences/edit/' + ${preference.id}}" class="table-link">Edit</a>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
</div>
</body>
</html>
